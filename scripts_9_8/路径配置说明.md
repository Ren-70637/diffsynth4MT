# è·¯å¾„é…ç½®è¯´æ˜

## ğŸ¯ æ¦‚è¿°

ç°åœ¨æ‰€æœ‰çš„ç¡¬ç¼–ç è·¯å¾„éƒ½å·²ç»æ”¹ä¸ºå¯é…ç½®çš„ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥è½»æ¾é€‚åº”ä¸åŒçš„éƒ¨ç½²ç¯å¢ƒã€‚

## ğŸ”§ é…ç½®æ–¹å¼

### æ–¹æ³•1ï¼šä½¿ç”¨é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰

```bash
# 1. ç¼–è¾‘é…ç½®æ–‡ä»¶
nano config.env

# 2. åŠ è½½é…ç½®
source config.env

# 3. è¿è¡Œå®éªŒ
./incremental_experiment.sh --category single_object --new-prompts new.json --new-videos-dir videos/
```

### æ–¹æ³•2ï¼šç›´æ¥è®¾ç½®ç¯å¢ƒå˜é‡

```bash
# è®¾ç½®åŸºç¡€è·¯å¾„
export EXPERIMENT_BASE_DIR="/your/custom/path"
export EXPERIMENT_WORK_DIR="/your/custom/path/diffsynth4MT"
export EXPERIMENT_OUTPUT_DIR="/your/custom/path/results"

# è¿è¡Œå®éªŒ
./incremental_experiment.sh --category single_object --new-prompts new.json --new-videos-dir videos/
```

### æ–¹æ³•3ï¼šä¸´æ—¶æŒ‡å®šå‚æ•°

```bash
# ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°è¦†ç›–é»˜è®¤é…ç½®
./incremental_experiment.sh \
    --category single_object \
    --new-prompts /custom/path/new.json \
    --new-videos-dir /custom/path/videos \
    --output-dir /custom/path/output
```

## ğŸ“‹ ä¸»è¦ç¯å¢ƒå˜é‡

| ç¯å¢ƒå˜é‡ | é»˜è®¤å€¼ | è¯´æ˜ |
|---------|--------|------|
| `EXPERIMENT_BASE_DIR` | `/root/autodl-tmp` | å®éªŒåŸºç¡€ç›®å½• |
| `EXPERIMENT_WORK_DIR` | `${BASE_DIR}/diffsynth4MT` | è„šæœ¬å·¥ä½œç›®å½• |
| `EXPERIMENT_OUTPUT_DIR` | `${BASE_DIR}/results_final_2` | å®éªŒè¾“å‡ºç›®å½• |
| `EXPERIMENT_LOG_DIR` | `${BASE_DIR}/logs` | æ—¥å¿—ç›®å½• |
| `EXPERIMENT_PROMPTS_FILE` | `${BASE_DIR}/Final_Dataset/prompt.json` | ä¸»promptsæ–‡ä»¶ |
| `MODEL_BASE_DIR` | `${BASE_DIR}/pretrained_models` | æ¨¡å‹æ–‡ä»¶ç›®å½• |
| `CONDA_BASE` | `/root/miniconda3` | Condaå®‰è£…è·¯å¾„ |
| `CONDA_ENV` | `diffsynth` | Condaç¯å¢ƒå |

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šæœ¬åœ°å¼€å‘ç¯å¢ƒ

```bash
# config.env
export EXPERIMENT_BASE_DIR="/home/user/diffsynth"
export CONDA_BASE="/home/user/miniconda3"
export CONDA_ENV="my_diffsynth"

# ä½¿ç”¨
source config.env
./incremental_experiment.sh --category single_object --new-prompts my_prompts.json --new-videos-dir my_videos/
```

### ç¤ºä¾‹2ï¼šæœåŠ¡å™¨ç¯å¢ƒ

```bash
# config.env  
export EXPERIMENT_BASE_DIR="/data/experiments"
export CONDA_BASE="/opt/conda"
export CONDA_ENV="production_diffsynth"
export EXPERIMENT_OUTPUT_DIR="/data/results"

# ä½¿ç”¨
source config.env
./incremental_experiment.sh --category single_object --new-prompts /data/new_prompts.json --new-videos-dir /data/videos/
```

### ç¤ºä¾‹3ï¼šäº‘æœåŠ¡å™¨ç¯å¢ƒ

```bash
# config.env
export EXPERIMENT_BASE_DIR="/workspace"
export MODEL_BASE_DIR="/shared/models"
export EXPERIMENT_OUTPUT_DIR="/shared/results"

# ä½¿ç”¨
source config.env
./incremental_experiment.sh --category single_object --new-prompts s3://bucket/prompts.json --new-videos-dir /workspace/videos/
```

## ğŸ” é…ç½®éªŒè¯

### æ£€æŸ¥å½“å‰é…ç½®

```bash
# æŸ¥çœ‹æ‰€æœ‰å®éªŒç›¸å…³ç¯å¢ƒå˜é‡
env | grep EXPERIMENT

# æŸ¥çœ‹æ¨¡å‹è·¯å¾„é…ç½®
env | grep MODEL

# æŸ¥çœ‹Condaé…ç½®
env | grep CONDA
```

### éªŒè¯è·¯å¾„æœ‰æ•ˆæ€§

```bash
# æ£€æŸ¥å…³é”®è·¯å¾„æ˜¯å¦å­˜åœ¨
echo "å·¥ä½œç›®å½•: ${EXPERIMENT_WORK_DIR} - $([ -d "${EXPERIMENT_WORK_DIR}" ] && echo "âœ…" || echo "âŒ")"
echo "æ¨¡å‹ç›®å½•: ${MODEL_BASE_DIR} - $([ -d "${MODEL_BASE_DIR}" ] && echo "âœ…" || echo "âŒ")"
echo "Condaç›®å½•: ${CONDA_BASE} - $([ -d "${CONDA_BASE}" ] && echo "âœ…" || echo "âŒ")"
```

## ğŸ“ ç›®å½•ç»“æ„ç¤ºä¾‹

```
${EXPERIMENT_BASE_DIR}/                 # å®éªŒåŸºç¡€ç›®å½•
â”œâ”€â”€ diffsynth4MT/                       # è„šæœ¬å·¥ä½œç›®å½•
â”‚   â”œâ”€â”€ incremental_experiment.sh
â”‚   â”œâ”€â”€ FastVMT_incremental.py
â”‚   â””â”€â”€ config.env
â”œâ”€â”€ Final_Dataset/                      # æ•°æ®é›†ç›®å½•
â”‚   â”œâ”€â”€ prompt.json
â”‚   â”œâ”€â”€ single_object/
â”‚   â””â”€â”€ camera_motion/
â”œâ”€â”€ pretrained_models/                  # æ¨¡å‹ç›®å½•
â”‚   â””â”€â”€ Wan-AI/Wan2.1-T2V-14B/
â”œâ”€â”€ results_final_2/                    # è¾“å‡ºç›®å½•
â”‚   â”œâ”€â”€ single_object/
â”‚   â””â”€â”€ camera_motion/
â””â”€â”€ logs/                              # æ—¥å¿—ç›®å½•
    â”œâ”€â”€ gpu_0/
    â”œâ”€â”€ gpu_1/
    â””â”€â”€ gpu_2/
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **è·¯å¾„æƒé™**: ç¡®ä¿æ‰€æœ‰é…ç½®çš„è·¯å¾„å…·æœ‰è¯»å†™æƒé™
2. **å­˜å‚¨ç©ºé—´**: ç¡®ä¿è¾“å‡ºç›®å½•æœ‰è¶³å¤Ÿçš„å­˜å‚¨ç©ºé—´
3. **ç½‘ç»œå­˜å‚¨**: å¦‚æœä½¿ç”¨ç½‘ç»œå­˜å‚¨ï¼Œç¡®ä¿ç½‘ç»œè¿æ¥ç¨³å®š
4. **ç¯å¢ƒæŒä¹…æ€§**: ç¯å¢ƒå˜é‡åœ¨æ–°shellä¸­éœ€è¦é‡æ–°åŠ è½½
5. **è·¯å¾„æ ¼å¼**: ä½¿ç”¨ç»å¯¹è·¯å¾„é¿å…ç›¸å¯¹è·¯å¾„é—®é¢˜

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **è·¯å¾„ä¸å­˜åœ¨**
   ```bash
   # è‡ªåŠ¨åˆ›å»ºå¿…è¦ç›®å½•
   mkdir -p "${EXPERIMENT_OUTPUT_DIR}"
   mkdir -p "${EXPERIMENT_LOG_DIR}"
   ```

2. **æƒé™é—®é¢˜**
   ```bash
   # ä¿®å¤æƒé™
   chmod -R 755 "${EXPERIMENT_WORK_DIR}"
   chown -R $USER "${EXPERIMENT_OUTPUT_DIR}"
   ```

3. **Condaç¯å¢ƒä¸å­˜åœ¨**
   ```bash
   # æ£€æŸ¥ç¯å¢ƒ
   conda env list | grep "${CONDA_ENV}"
   
   # åˆ›å»ºç¯å¢ƒ
   conda create -n "${CONDA_ENV}" python=3.8
   ```

4. **æ¨¡å‹æ–‡ä»¶ç¼ºå¤±**
   ```bash
   # æ£€æŸ¥æ¨¡å‹æ–‡ä»¶
   ls -la "${MODEL_BASE_DIR}/Wan-AI/Wan2.1-T2V-14B/"
   
   # ä¸‹è½½æ¨¡å‹
   python download_model.py
   ```

## ğŸ”„ è¿ç§»æŒ‡å—

### ä»ç¡¬ç¼–ç è·¯å¾„è¿ç§»

1. **å¤‡ä»½ç°æœ‰é…ç½®**
   ```bash
   cp incremental_experiment.sh incremental_experiment.sh.backup
   ```

2. **åº”ç”¨æ–°é…ç½®**
   ```bash
   # ç¼–è¾‘ config.env è®¾ç½®è·¯å¾„
   source config.env
   ```

3. **éªŒè¯åŠŸèƒ½**
   ```bash
   ./incremental_experiment.sh --help
   ```

4. **æµ‹è¯•è¿è¡Œ**
   ```bash
   ./incremental_experiment.sh --category test --new-prompts test.json --new-videos-dir test_videos/
   ```