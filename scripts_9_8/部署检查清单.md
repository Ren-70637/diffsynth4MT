# å¤šGPUå¹¶è¡Œè§†é¢‘ç”Ÿæˆå®éªŒ - éƒ¨ç½²æ£€æŸ¥æ¸…å•

## âœ… å·²åˆ›å»ºçš„æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒè„šæœ¬
- [x] `FastVMT_multi_gpu.py` - å¤šGPUå¹¶è¡Œè§†é¢‘ç”Ÿæˆä¸»ç¨‹åº
- [x] `start_multi_gpu_experiment.sh` - å®éªŒå¯åŠ¨è„šæœ¬
- [x] `stop_experiment.sh` - å®éªŒåœæ­¢è„šæœ¬
- [x] `monitor_experiment.sh` - å®éªŒç›‘æ§è„šæœ¬
- [x] `check_results.sh` - ç»“æœæ£€æŸ¥è„šæœ¬
- [x] `tmux_manager.sh` - tmuxä¼šè¯ç®¡ç†å™¨

### æ–‡æ¡£
- [x] `å¤šGPUå®éªŒè¿è¡Œè¯¦ç»†æ“ä½œæ–‡æ¡£.md` - è¯¦ç»†æ“ä½œæŒ‡å—
- [x] `å®éªŒå¯åŠ¨æŒ‡å—.md` - å¿«é€Ÿå¯åŠ¨æŒ‡å—
- [x] `éƒ¨ç½²æ£€æŸ¥æ¸…å•.md` - æœ¬æ–‡ä»¶

## ğŸ”§ éƒ¨ç½²å‰æ£€æŸ¥

### 1. ç¯å¢ƒæ£€æŸ¥
```bash
# æ£€æŸ¥GPUæ•°é‡å’ŒçŠ¶æ€
nvidia-smi | grep "Tesla\|GeForce\|RTX\|H20"

# æ£€æŸ¥condaç¯å¢ƒ
conda info --envs | grep diffsynth

# æ£€æŸ¥PythonåŒ…
conda activate diffsynth
python -c "import torch; print(f'PyTorch: {torch.__version__}, CUDA: {torch.cuda.is_available()}')"
python -c "import diffsynth; print('DiffSynth available')"
```

### 2. æ•°æ®æ–‡ä»¶æ£€æŸ¥
```bash
# æ£€æŸ¥promptsæ–‡ä»¶
ls -la /root/autodl-tmp/Final_Dataset/prompt.json

# æ£€æŸ¥è§†é¢‘æ–‡ä»¶
find /root/autodl-tmp/Final_Dataset -name "*.mp4" | wc -l

# éªŒè¯æ¯ä¸ªç±»åˆ«çš„è§†é¢‘æ–‡ä»¶
ls -la /root/autodl-tmp/Final_Dataset/camera_motion/
ls -la /root/autodl-tmp/Final_Dataset/single_object/
ls -la /root/autodl-tmp/Final_Dataset/multiple_objects/
ls -la /root/autodl-tmp/Final_Dataset/complex_human_motion/
```

### 3. æ¨¡å‹æ–‡ä»¶æ£€æŸ¥
```bash
# æ£€æŸ¥Wan2.1-T2V-14Bæ¨¡å‹æ–‡ä»¶
ls -la /root/autodl-tmp/pretrained_models/Wan-AI/Wan2.1-T2V-14B/

# éªŒè¯æ‰€æœ‰æ¨¡å‹æ–‡ä»¶å­˜åœ¨
file_list=(
    "diffusion_pytorch_model-00001-of-00006.safetensors"
    "diffusion_pytorch_model-00002-of-00006.safetensors"
    "diffusion_pytorch_model-00003-of-00006.safetensors"
    "diffusion_pytorch_model-00004-of-00006.safetensors"
    "diffusion_pytorch_model-00005-of-00006.safetensors"
    "diffusion_pytorch_model-00006-of-00006.safetensors"
    "models_t5_umt5-xxl-enc-bf16.pth"
    "Wan2.1_VAE.pth"
)

for file in "${file_list[@]}"; do
    if [ -f "/root/autodl-tmp/pretrained_models/Wan-AI/Wan2.1-T2V-14B/$file" ]; then
        echo "âœ… $file"
    else
        echo "âŒ $file ç¼ºå¤±"
    fi
done
```

### 4. æƒé™æ£€æŸ¥
```bash
# æ£€æŸ¥è„šæœ¬æ‰§è¡Œæƒé™
ls -la /root/autodl-tmp/diffsynth4MT/*.sh
```

### 5. ç£ç›˜ç©ºé—´æ£€æŸ¥
```bash
# æ£€æŸ¥å¯ç”¨ç£ç›˜ç©ºé—´ (å»ºè®®è‡³å°‘100GB)
df -h /root/autodl-tmp/

# åˆ›å»ºå¿…è¦ç›®å½•
mkdir -p /root/autodl-tmp/results_final
mkdir -p /root/autodl-tmp/logs/{gpu_0,gpu_1,gpu_2,gpu_3}
```

## ğŸš€ å¯åŠ¨å‰æœ€åæ£€æŸ¥

### éªŒè¯è„šæœ¬
```bash
cd /root/autodl-tmp/diffsynth4MT

# æµ‹è¯•è„šæœ¬è¯­æ³•
bash -n start_multi_gpu_experiment.sh
bash -n stop_experiment.sh
bash -n monitor_experiment.sh
bash -n check_results.sh
bash -n tmux_manager.sh

# æµ‹è¯•Pythonè„šæœ¬è¯­æ³•
python -m py_compile FastVMT_multi_gpu.py
```

### ä¾èµ–æ£€æŸ¥
```bash
# æ£€æŸ¥tmux
which tmux || echo "éœ€è¦å®‰è£…: sudo apt-get install tmux"

# æ£€æŸ¥bc (ç”¨äºè®¡ç®—)
which bc || echo "éœ€è¦å®‰è£…: sudo apt-get install bc"

# æ£€æŸ¥ffprobe (ç”¨äºè§†é¢‘éªŒè¯)
which ffprobe || echo "éœ€è¦å®‰è£…: sudo apt-get install ffmpeg"
```

## ğŸ“‹ å®éªŒé…ç½®æ€»ç»“

### GPUåˆ†é…
- **GPU 0**: camera_motion (é•œå¤´è¿åŠ¨) - 17ä¸ªè§†é¢‘ Ã— 5ä¸ªprompt Ã— 2ä¸ªseed = 170ä¸ªä»»åŠ¡
- **GPU 1**: single_object (å•ä¸ªç‰©ä½“) - 30ä¸ªè§†é¢‘ Ã— 5ä¸ªprompt Ã— 2ä¸ªseed = 300ä¸ªä»»åŠ¡
- **GPU 2**: multiple_objects (å¤šä¸ªç‰©ä½“) - 20ä¸ªè§†é¢‘ Ã— 5ä¸ªprompt Ã— 2ä¸ªseed = 200ä¸ªä»»åŠ¡
- **GPU 3**: complex_human_motion (å¤æ‚äººä½“è¿åŠ¨) - 13ä¸ªè§†é¢‘ Ã— 5ä¸ªprompt Ã— 2ä¸ªseed = 130ä¸ªä»»åŠ¡

### é¢„æœŸç»“æœ
- **æ€»è§†é¢‘æ•°**: 800ä¸ª
- **æ€»å­˜å‚¨ç©ºé—´**: çº¦50-100GB
- **é¢„è®¡æ—¶é—´**: 4-8å°æ—¶
- **Seeds**: 42, 123

### è¾“å‡ºç»“æ„
```
/root/autodl-tmp/results_final/
â”œâ”€â”€ camera_motion/
â”œâ”€â”€ single_object/
â”œâ”€â”€ multiple_objects/
â””â”€â”€ complex_human_motion/
    â””â”€â”€ ref_xxx_832x480/
        â”œâ”€â”€ prompt1_seed42/video1.mp4
        â”œâ”€â”€ prompt1_seed123/video1.mp4
        â”œâ”€â”€ prompt2_seed42/video1.mp4
        â”œâ”€â”€ prompt2_seed123/video1.mp4
        â”œâ”€â”€ prompt3_seed42/video1.mp4
        â”œâ”€â”€ prompt3_seed123/video1.mp4
        â”œâ”€â”€ prompt4_seed42/video1.mp4
        â”œâ”€â”€ prompt4_seed123/video1.mp4
        â”œâ”€â”€ prompt5_seed42/video1.mp4
        â””â”€â”€ prompt5_seed123/video1.mp4
```

## ğŸ¯ å¯åŠ¨å‘½ä»¤

### ä¸€é”®å¯åŠ¨
```bash
cd /root/autodl-tmp/diffsynth4MT
./start_multi_gpu_experiment.sh
```

### ç›‘æ§å‘½ä»¤
```bash
# å®æ—¶ç›‘æ§
./monitor_experiment.sh

# ä¼šè¯ç®¡ç†
./tmux_manager.sh

# è‡ªåŠ¨åˆ·æ–°ç›‘æ§
watch -n 30 ./monitor_experiment.sh
```

### åœæ­¢å‘½ä»¤
```bash
./stop_experiment.sh
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä¿æŒè¿æ¥**: ä½¿ç”¨tmuxç¡®ä¿SSHæ–­å¼€æ—¶å®éªŒç»§ç»­è¿è¡Œ
2. **ç›‘æ§èµ„æº**: å®šæœŸæ£€æŸ¥GPUä½¿ç”¨ç‡å’Œç£ç›˜ç©ºé—´
3. **å¤‡ä»½æ—¥å¿—**: å®éªŒè¿‡ç¨‹ä¸­çš„æ—¥å¿—æ–‡ä»¶å¾ˆé‡è¦
4. **é”™è¯¯å¤„ç†**: å¦‚æœæŸä¸ªGPUå¤±è´¥ï¼Œå¯ä»¥æ‰‹åŠ¨é‡å¯è¯¥GPUçš„ä»»åŠ¡

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **æ˜¾å­˜ä¸è¶³**: è°ƒæ•´num_persistentå‚æ•°
2. **æ¨¡å‹è·¯å¾„é”™è¯¯**: æ£€æŸ¥æ¨¡å‹æ–‡ä»¶å®Œæ•´æ€§
3. **æƒé™é—®é¢˜**: ç¡®ä¿æ‰€æœ‰è„šæœ¬æœ‰æ‰§è¡Œæƒé™
4. **ä¾èµ–ç¼ºå¤±**: å®‰è£…å¿…è¦çš„ç³»ç»ŸåŒ…

### ç´§æ€¥æ¢å¤
```bash
# å¼ºåˆ¶åœæ­¢æ‰€æœ‰è¿›ç¨‹
pkill -f FastVMT_multi_gpu
tmux kill-server

# æ¸…ç†GPUæ˜¾å­˜
nvidia-smi --gpu-reset

# é‡æ–°å¯åŠ¨
./start_multi_gpu_experiment.sh
```

---

**âœ… æ£€æŸ¥å®Œæ¯•ï¼Œå¯ä»¥å¼€å§‹å®éªŒï¼**

å¯åŠ¨å‘½ä»¤: `./start_multi_gpu_experiment.sh`